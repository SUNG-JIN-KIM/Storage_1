<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ëœë¤ ìŠ¤í° & ê³¨ì¸ ë¯¸ë¡œ ê²Œì„</title>
  <style>
    body {
      background-color: #121212;
      color: white;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 30px;
    }
    #maze {
      display: grid;
      gap: 2px;
      margin-top: 20px;
      user-select: none;
    }
    .cell {
      width: 40px;
      height: 40px;
      text-align: center;
      line-height: 40px;
      font-size: 24px;
    }
    .wall {
      background-color: #333;
    }
    .player {
      background-color: #00cc66;
    }
    .goal {
      background-color: #ffcc00;
    }
    .bomb {
      background-color: red;
    }
    #message {
      margin-top: 20px;
      font-size: 20px;
      height: 30px;
      min-height: 30px;
    }
  </style>
</head>
<body>

<h1>ğŸ’£ ëœë¤ ìŠ¤í° & ê³¨ì¸ ë¯¸ë¡œ ê²Œì„</h1>
<p>ë°©í–¥í‚¤ë¡œ ì´ë™ | ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ í­íƒ„ ì„¤ì¹˜ | í­íƒ„ìœ¼ë¡œ ë²½ì„ ë¶€ìˆ˜ë©´ì„œ ê³¨ì¸ì§€ì ì— ë„ë‹¬í•˜ì„¸ìš”!</p>
<div id="maze"></div>
<div id="message"></div>

<script>
  // ê¸°ë³¸ ë¹ˆ ë§µ í‹€ (1:ë²½, 0:ë¹ˆì¹¸) - ë²½ìœ¼ë¡œ í…Œë‘ë¦¬ ê³ ì •
  const baseMap = [
    [1,1,1,1,1,1,1,1,1],
    [1,0,0,0,0,0,0,0,1],
    [1,0,1,1,1,1,1,0,1],
    [1,0,1,0,0,0,1,0,1],
    [1,0,1,0,1,0,1,0,1],
    [1,0,1,0,0,0,1,0,1],
    [1,0,1,1,1,1,1,0,1],
    [1,0,0,0,0,0,0,0,1],
    [1,1,1,1,1,1,1,1,1],
  ];

  let map;
  let playerPos = null;
  let bombs = [];
  let hasDestroyedWall = false;

  const mazeEl = document.getElementById("maze");
  const messageEl = document.getElementById("message");

  function deepCopy(arr) {
    return JSON.parse(JSON.stringify(arr));
  }

  // ë¹ˆ ì¹¸ ì¢Œí‘œ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜ (ë²½ê³¼ S,G ì œì™¸)
  function getEmptyCells(m) {
    const empties = [];
    for(let y=0; y<m.length; y++){
      for(let x=0; x<m[y].length; x++){
        if(m[y][x] === 0) empties.push({x,y});
      }
    }
    return empties;
  }

  // ëœë¤ ì •ìˆ˜ (min ì´ìƒ max ì´í•˜)
  function randInt(min,max){
    return Math.floor(Math.random()*(max-min+1))+min;
  }

  // ë§µ ì´ˆê¸°í™” - Sì™€ Gë¥¼ ë¹ˆì¹¸ ì¤‘ ëœë¤ ë°°ì¹˜ + ê³¨ì¸ ì£¼ë³€ ë²½ ëœë¤ ì„¤ì¹˜
  function initMap(){
    map = deepCopy(baseMap);

    const empties = getEmptyCells(map);

    // S, G ëœë¤ ë°°ì¹˜ (ì„œë¡œ ë‹¤ë¥¸ ìœ„ì¹˜)
    const idxS = randInt(0, empties.length-1);
    let idxG;
    do {
      idxG = randInt(0, empties.length-1);
    } while(idxG === idxS);

    const start = empties[idxS];
    const goal = empties[idxG];

    map[start.y][start.x] = 'S';
    map[goal.y][goal.x] = 'G';
    playerPos = {x: start.x, y: start.y};
    bombs = [];
    hasDestroyedWall = false;

    // ê³¨ì¸ ì£¼ë³€ 8ë°©í–¥ ì¢Œí‘œ
    const nearCoords = [
      {x:goal.x-1,y:goal.y-1},{x:goal.x,y:goal.y-1},{x:goal.x+1,y:goal.y-1},
      {x:goal.x-1,y:goal.y},{x:goal.x+1,y:goal.y},
      {x:goal.x-1,y:goal.y+1},{x:goal.x,y:goal.y+1},{x:goal.x+1,y:goal.y+1},
    ];

    // ì£¼ë³€ ë¹ˆì¹¸ ì¢Œí‘œë§Œ í•„í„°ë§
    const nearEmpty = nearCoords.filter(c=>
      c.x>=0 && c.x<map[0].length &&
      c.y>=0 && c.y<map.length &&
      map[c.y][c.x] === 0
    );

    // ë§‰ì•„ì•¼ í•  ë²½ ê°œìˆ˜ (1~nearEmpty.length ì¤‘ ëœë¤, ìµœì†Œ 3 ì´ìƒ ê¶Œì¥)
    const blockCount = Math.min(nearEmpty.length, randInt(3, nearEmpty.length));

    // ëœë¤ìœ¼ë¡œ ë²½ ì„¸ìš°ê¸°
    for(let i=0; i<blockCount; i++){
      if(nearEmpty.length === 0) break;
      const randIdx = randInt(0, nearEmpty.length-1);
      const blockCell = nearEmpty.splice(randIdx,1)[0];
      map[blockCell.y][blockCell.x] = 1;
    }
  }

  function renderMaze(){
    mazeEl.innerHTML = "";
    mazeEl.style.gridTemplateColumns = `repeat(${map[0].length}, 40px)`;
    mazeEl.style.gridTemplateRows = `repeat(${map.length}, 40px)`;
    for(let y=0; y<map.length; y++){
      for(let x=0; x<map[y].length; x++){
        const cell = document.createElement("div");
        cell.classList.add("cell");
        if(map[y][x] === 1) cell.classList.add("wall");
        if(x===playerPos.x && y===playerPos.y){
          cell.classList.add("player");
          cell.textContent = "ğŸŸ©";
        } else if(map[y][x] === 'G'){
          cell.classList.add("goal");
          cell.textContent = "ğŸ¯";
        } else if(bombs.some(b=>b.x===x && b.y===y)){
          cell.classList.add("bomb");
          cell.textContent = "ğŸ’£";
        }
        mazeEl.appendChild(cell);
      }
    }
  }

  function movePlayer(dx, dy){
    const newX = playerPos.x + dx;
    const newY = playerPos.y + dy;
    if(
      newY>=0 && newY<map.length &&
      newX>=0 && newX<map[0].length &&
      map[newY][newX] !== 1
    ){
      playerPos = {x:newX, y:newY};

      if(map[newY][newX] === 'G'){
        if(!hasDestroyedWall){
          messageEl.textContent = "ğŸš« í­íƒ„ìœ¼ë¡œ ë²½ì„ ë¶€ìˆ˜ê³  ê³¨ì¸í•˜ì„¸ìš”!";
        } else {
          messageEl.textContent = "ğŸ‰ í´ë¦¬ì–´! ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.";
          setTimeout(() => {
            initMap();
            renderMaze();
            messageEl.textContent = "";
          }, 1500);
          return;
        }
      }
      renderMaze();
      messageEl.textContent = "";
    }
  }

  function placeBomb(){
    if(bombs.length >= 1){
      messageEl.textContent = "ğŸ’£ ì´ë¯¸ í­íƒ„ì´ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤!";
      return;
    }
    const {x,y} = playerPos;
    if(bombs.some(b=>b.x === x && b.y === y)) return;
    bombs.push({x,y});
    messageEl.textContent = "ğŸ’£ í­íƒ„ ì„¤ì¹˜ë¨! 2ì´ˆ í›„ í­ë°œ!";
    renderMaze();
    setTimeout(()=>explodeBomb(x,y), 2000);
  }

  function explodeBomb(x,y){
    bombs = bombs.filter(b=> !(b.x===x && b.y===y));

    const explosionCells = [
      {x,y},
      {x:x,y:y-1},
      {x:x,y:y+1},
      {x:x-1,y:y},
      {x:x+1,y:y}
    ];

    let destroyedWall = false;
    for(const cell of explosionCells){
      if(
        cell.y>=0 && cell.y<map.length &&
        cell.x>=0 && cell.x<map[0].length
      ){
        if(map[cell.y][cell.x] === 1){
          map[cell.y][cell.x] = 0;
          destroyedWall = true;
          hasDestroyedWall = true;
        }
      }
    }
    if(destroyedWall){
      messageEl.textContent = "ğŸ’¥ í­ë°œë¡œ ë²½ì„ ë¶€ì…¨ìŠµë‹ˆë‹¤!";
    } else {
      messageEl.textContent = "ğŸ’¥ í­ë°œí–ˆì§€ë§Œ ë¶€ìˆ  ë²½ì´ ì—†ì—ˆì–´ìš”.";
    }
    renderMaze();
  }

  function handleKey(e){
    switch(e.key){
      case "ArrowUp": e.preventDefault(); movePlayer(0,-1); break;
      case "ArrowDown": e.preventDefault(); movePlayer(0,1); break;
      case "ArrowLeft": e.preventDefault(); movePlayer(-1,0); break;
      case "ArrowRight": e.preventDefault(); movePlayer(1,0); break;
      case " ": e.preventDefault(); placeBomb(); break;
    }
  }

  // ì´ˆê¸°í™”
  initMap();
  renderMaze();
  document.addEventListener("keydown", handleKey);
</script>

</body>
</html>
